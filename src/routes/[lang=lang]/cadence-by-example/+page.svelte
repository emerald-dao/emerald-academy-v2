<script type="ts">
	import { InputWrapper } from '@emerald-dao/component-library';
	import { locale, LL } from '$i18n/i18n-svelte';
	import { createSearchStore, searchHandler } from '$stores/searchBar';
	import { onDestroy } from 'svelte';
	import { Seo } from '@emerald-dao/component-library';
	import Icon from '@iconify/svelte';

	export let data;

	$: searchCadence = data.content.map((example) => ({
		...example,
		searchTerms: `${example.meta.title}`
	}));

	$: searchStore = createSearchStore(searchCadence);

	$: unsubscribe = searchStore.subscribe((model) => searchHandler(model));

	onDestroy(() => {
		unsubscribe();
	});
</script>

<section class="container-small column-10">
	<h1 class="w-medium">Cadence by Example</h1>
	<p class="alert">
		<i>
			Cadence by Example is now using
			<a
				href="https://forum.flow.com/t/update-on-cadence-1-0/5197"
				target="_blank"
				style="text-decoration: none; color: var(--clr-alert-500);"
			>
				Cadence 1.0</a
			>. This <b>will not work</b> with current Cadence, but given that Cadence 1.0 is being released
			in 2024, we believe it is more beneficial to learn the new material.
		</i>
	</p>
	{#if data.content.length === 0}
		<p><em>{$LL.NO_EXAMPLES_FOUND()}</em></p>
	{:else}
		<div class="main-wrapper">
			<div class="sidebar">
				<h5>{$LL.SEARCH()}</h5>
				<InputWrapper name="search" errors={[]} isValid={false} icon="tabler:search">
					<input type="text" placeholder="Search..." bind:value={$searchStore.search} />
				</InputWrapper>
			</div>
			<div class="main">
				{#if $searchStore.search.length > 0 && $searchStore.filtered.length === 0}
					<p>No results found</p>
				{/if}
				{#each $searchStore.filtered as content, i}
					<a
						class="card heading"
						href={`/${$locale}/cadence-by-example/${content.path.split('/')[3]}`}
						>{`${i + 1}. ${content.meta.title}`}</a
					>
				{/each}
			</div>
		</div>
	{/if}
</section>

<Seo
	title={`Cadence by Example | Emerald Academy`}
	description="Basic Cadence code examples"
	type="WebPage"
	image="https://academy.ecdao.org/favicon.png"
/>

<style type="scss">
	section {
		.alert {
			color: var(--clr-alert-100);
		}

		.main-wrapper {
			display: flex;
			flex-direction: column;
			gap: var(--space-5);

			@include mq(small) {
				display: grid;
				grid-template-columns: 1fr 3fr;
				gap: var(--space-10);
			}
			.sidebar {
				display: flex;
				flex-direction: column;
				border-bottom: var(--border-width-primary) var(--clr-border-primary) solid;
				padding-bottom: var(--space-5);

				@include mq(small) {
					border-right: var(--border-width-primary) var(--clr-border-primary) solid;
					border-bottom: 0;
					height: fit-content;
					padding-bottom: var(--space-8);
					padding-right: var(--space-10);
					position: sticky;
					top: 100px;
					gap: 0;
				}

				h5 {
					font-size: var(--font-size-4);
					margin-bottom: var(--space-2);
					margin-top: 0;
				}
			}

			.main {
				display: flex;
				flex-direction: column;
				gap: var(--space-5);

				.card {
					text-decoration: none;
					padding: var(--space-4) var(--space-6);
					transition: 0.3s;
				}
			}
		}
	}
</style>
